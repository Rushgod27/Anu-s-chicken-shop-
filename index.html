<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<!-- üîí iPad ZOOM LOCK (VERY IMPORTANT) -->
<meta name="viewport"
  content="width=device-width,
           initial-scale=1.0,
           maximum-scale=1.0,
           user-scalable=no">

<title>Anu‚Äôs Chicken Shop ‚Äì POS</title>

<style>
/* üîí GLOBAL SAFETY FOR iPAD */
html, body{
  margin:0;
  padding:0;
  font-family:system-ui;
  background:#f1f5f9;
  -webkit-text-size-adjust:100%; /* stop text zoom */
  touch-action:manipulation;    /* stop double-tap zoom */
}

*{
  box-sizing:border-box;
  touch-action:manipulation;    /* üîë applies to buttons */
}

.header{
  background:linear-gradient(135deg,#fbbf24,#f59e0b);
  padding:14px;
  font-size:26px;
  font-weight:900;
  text-align:center;
}

.container{max-width:1400px;margin:auto;padding:10px}
.main{display:grid;grid-template-columns:1fr 420px;gap:14px}

.card{
  background:#fff;
  border-radius:18px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
}

h3{margin:0 0 10px;font-size:20px}
.row{display:flex;gap:10px;margin-bottom:10px}

/* INPUTS */
input{
  width:100%;
  padding:14px;
  font-size:18px;
  border-radius:14px;
  border:1px solid #cbd5f5;
  background:#f8fafc;
  readonly:true;
}

/* üîµ ACTIVE INPUT */
input.active-input{
  border:2px solid #2563eb;
  box-shadow:0 0 0 3px rgba(37,99,235,.25);
  background:#fff;
}

/* BUTTONS */
.btn{
  flex:1;
  padding:14px;
  font-size:16px;
  font-weight:800;
  border:none;
  border-radius:14px;
  background:#e5e7eb;
}
.btn.active{background:#fbbf24}

.primary{
  background:#4f46e5;
  color:#fff;
  width:100%;
  padding:18px;
  font-size:22px;
  font-weight:900;
  border:none;
  border-radius:16px;
}

/* TOTAL */
.total{
  background:#dbeafe;
  font-size:26px;
  font-weight:900;
  padding:14px;
  border-radius:16px;
  text-align:center;
}

.return{
  background:#dcfce7;
  font-size:20px;
  font-weight:900;
  padding:12px;
  border-radius:14px;
}
.return.negative{
  background:#fee2e2;
  color:#991b1b;
}

/* KEYPAD */
.keypad-wrap{
  position:sticky;
  top:10px;
  height:80vh;
}

.keypad{
  background:#111827;
  border-radius:26px;
  padding:16px;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
  height:100%;
}

/* üîµ ACTIVE KEYPAD */
.keypad.active{
  outline:4px solid #2563eb;
}

.keypad button{
  font-size:32px;
  font-weight:900;
  border:none;
  border-radius:20px;
  background:#374151;
  color:#fff;
}
.keypad .del{background:#ef4444}

/* MOBILE */
@media(max-width:900px){
  .main{grid-template-columns:1fr}
  .keypad-wrap{
    position:fixed;
    bottom:0;left:0;right:0;
    height:260px;
    z-index:999;
  }
  .container{padding-bottom:280px}
}
</style>
</head>

<body>

<div class="header">üêî Anu‚Äôs Chicken Shop ‚Äì POS</div>

<div class="container">
<div class="main">

<!-- LEFT -->
<div>

<div class="card">
<h3>Prices</h3>
<div class="row">
  <input id="broilerPrice" placeholder="Broiler ‚Çπ/kg" readonly onclick="setActive(this)">
  <input id="countryPrice" placeholder="Country ‚Çπ/kg" readonly onclick="setActive(this)">
  <input id="eggPrice" placeholder="Egg ‚Çπ" readonly onclick="setActive(this)">
</div>
<button class="primary" onclick="savePrices()">Save Prices</button>
</div>

<div class="card">
<h3>Add Items</h3>
<div class="row">
  <button class="btn" onclick="toggleItem('broiler',this)">Broiler</button>
  <button class="btn" onclick="toggleItem('country',this)">Country</button>
  <button class="btn" onclick="toggleItem('egg',this)">Eggs</button>
</div>
</div>

<div class="card" id="broilerBox" style="display:none">
<h3>Broiler</h3>
<div class="row">
  <button class="btn" onclick="setMode('broiler','kg',this)">KG</button>
  <button class="btn" onclick="setMode('broiler','rs',this)">‚Çπ</button>
</div>
<input id="broilerKg" placeholder="KG" readonly onclick="setActive(this)">
<input id="broilerRs" placeholder="Amount ‚Çπ" readonly style="display:none" onclick="setActive(this)">
</div>

<div class="card" id="countryBox" style="display:none">
<h3>Country</h3>
<div class="row">
  <button class="btn" onclick="setMode('country','kg',this)">KG</button>
  <button class="btn" onclick="setMode('country','rs',this)">‚Çπ</button>
</div>
<input id="countryKg" placeholder="KG" readonly onclick="setActive(this)">
<input id="countryRs" placeholder="Amount ‚Çπ" readonly style="display:none" onclick="setActive(this)">
</div>

<div class="card" id="eggBox" style="display:none">
<h3>Eggs</h3>
<input id="eggQty" placeholder="Quantity" readonly onclick="setActive(this)">
</div>

<div class="card">
<h3>Payment</h3>
<div class="row">
  <button class="btn" onclick="setPayment('cash',this)">Cash</button>
  <button class="btn" onclick="setPayment('online',this)">Online</button>
</div>
<div id="cashBox" style="display:none">
  <input id="received" placeholder="Amount Received ‚Çπ" readonly onclick="setActive(this)">
  <div class="return" id="returnBox">
    Return ‚Çπ <span id="returnAmt">0.00</span>
  </div>
</div>
</div>

<div class="card">
<h3>Bill</h3>
<div id="summary">No items</div>
<div class="total">
  TOTAL ‚Çπ <span id="totalAmt">0.00</span>
</div>
<button class="primary" onclick="confirmSale()">SALE</button>
</div>

</div>

<!-- RIGHT -->
<div class="keypad-wrap">
<div class="keypad">
  <button onclick="press('7')">7</button>
  <button onclick="press('8')">8</button>
  <button onclick="press('9')">9</button>
  <button onclick="press('4')">4</button>
  <button onclick="press('5')">5</button>
  <button onclick="press('6')">6</button>
  <button onclick="press('1')">1</button>
  <button onclick="press('2')">2</button>
  <button onclick="press('3')">3</button>
  <button onclick="press('.')">.</button>
  <button onclick="press('0')">0</button>
  <button class="del" onclick="back()">‚å´</button>
</div>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import {
  getFirestore, collection, addDoc,
  query, where, orderBy, limit, getDocs,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

/* üî• YOUR FIREBASE CONFIG (UPDATED) */
const firebaseConfig = {
  apiKey: "AIzaSyComVLxo36wvogoBFEoWyea-_yESW9BIPU",
  authDomain: "anus-chicken-shop.firebaseapp.com",
  projectId: "anus-chicken-shop",
  storageBucket: "anus-chicken-shop.firebasestorage.app",
  messagingSenderId: "919858203138",
  appId: "1:919858203138:web:0488b2c97155616b50751b",
  measurementId: "G-LJTZ78QS04"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const today = new Date().toISOString().slice(0,10);

let activeInput=null;
let payment=null;
let active={broiler:false,country:false,egg:false};
let mode={broiler:"kg",country:"kg"};

window.setActive = el => {
  document.querySelectorAll("input").forEach(i=>i.classList.remove("active-input"));
  el.classList.add("active-input");
  activeInput = el;
  document.querySelector(".keypad").classList.add("active");
};

window.press = v => {
  if(activeInput){
    activeInput.value += v;
    calc();
  }
};
window.back = () => {
  if(activeInput){
    activeInput.value = activeInput.value.slice(0,-1);
    calc();
  }
};

window.toggleItem = (t,b) => {
  active[t]=!active[t];
  b.classList.toggle("active");
  document.getElementById(t+"Box").style.display = active[t]?"block":"none";
  calc();
};

window.setMode = (t,m,b) => {
  mode[t]=m;
  document.getElementById(t+"Kg").style.display = m==="kg"?"block":"none";
  document.getElementById(t+"Rs").style.display = m==="rs"?"block":"none";
  b.parentElement.querySelectorAll(".btn").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");
  calc();
};

window.setPayment = (p,b) => {
  payment=p;
  cashBox.style.display = p==="cash"?"block":"none";
  b.parentElement.querySelectorAll(".btn").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");
};

function calc(){
  let total=0, lines=[];
  if(active.broiler){
    let amt = mode.broiler==="kg"
      ? (+broilerKg.value||0)*(+broilerPrice.value||0)
      : (+broilerRs.value||0);
    if(amt){ total+=amt; lines.push(`Broiler ‚Çπ${amt}`); }
  }
  if(active.country){
    let amt = mode.country==="kg"
      ? (+countryKg.value||0)*(+countryPrice.value||0)
      : (+countryRs.value||0);
    if(amt){ total+=amt; lines.push(`Country ‚Çπ${amt}`); }
  }
  if(active.egg){
    let amt = (+eggQty.value||0)*(+eggPrice.value||0);
    if(amt){ total+=amt; lines.push(`Eggs ‚Çπ${amt}`); }
  }
  totalAmt.innerText = total.toFixed(2);
  summary.innerHTML = lines.join("<br>") || "No items";

  if(payment==="cash"){
    let r=(+received.value||0)-total;
    returnAmt.innerText=r.toFixed(2);
    returnBox.classList.toggle("negative", r<0);
  }
}

/* LOAD LATEST PRICE */
async function loadPrices(){
  const q=query(
    collection(db,"dailyPrices"),
    where("date","==",today),
    orderBy("updatedAtMs","desc"),
    limit(1)
  );
  const snap = await getDocs(q);
  if(!snap.empty){
    const d = snap.docs[0].data();
    broilerPrice.value=d.broilerPrice;
    countryPrice.value=d.countryPrice;
    eggPrice.value=d.eggPrice;
  }
}
loadPrices();

window.savePrices = async () => {
  await addDoc(collection(db,"dailyPrices"),{
    date:today,
    broilerPrice:+broilerPrice.value,
    countryPrice:+countryPrice.value,
    eggPrice:+eggPrice.value,
    updatedAt:serverTimestamp(),
    updatedAtMs:Date.now()
  });
  alert("Price saved");
};

window.confirmSale = async () => {
  alert("Sale saved");
  location.reload();
};
</script>

</body>
</html>